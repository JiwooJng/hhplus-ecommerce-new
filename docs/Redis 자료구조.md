# Redis 자료 구조를 활용한 선착순 쿠폰 발급 시스템
## 요구사항
- Redis 자료 구조를 활용해서 선착순 쿠폰 발급 시스템을 개선한다.
  
## 설계
### Redis Sorted Set (ZSet)
- 대기열 방식으로 트래픽 분산
- 선착순 정렬
- 중복 방지
  
### 발급 흐름
1. 사용자가 쿠폰 발급 요청을 한다. 
2. 요청 대기열(ZSet) 에 요청을 추가한다. 
3. 스케줄러가 설정 주기에 따라 대기열에서 설정 batch 사이즈만큼 요청을 가져와서
4. 쿠폰 수량을 차감한다.
5. 차감 시 < 0인 경우 실패를 반환한다.
6. 처리된 요청은 대기열에서 삭제한다.

### 데이터 구조 및 키 
요청 대기열
- key : coupon/waiting
- value : couponId:userId
- score : 요청 시간

setnx 옵션
- 중복 방지를 위한 옵션
- 해당 key의 대기열에 같은 value를 가진 요청이 없을 때만 추가

### 추가적으로 보완해야 할 점
- 발급 가능한 쿠폰 수량이 모두 소진 되었을 경우
  - 해당 couponId 를 가진 coupon 을 비활성 상태로 만들고
  - 발급 요청 시 해당 couponId 를 가진 coupon 이 활성 상태인지 확인하는 로직 추가
  - 활성 상태라면 요청 대기열에 저장할 수 있도록 수정 
- 모니터링/이벤트 처리
  - 발급 성공 혹은 실패 로그를 수집하여 사용자에게 제공 

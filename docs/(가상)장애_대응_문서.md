# (가상) 장애 대응 문서

## 예상되는 장애 시나리오 - 선착순 쿠폰 발급 API 

### 1. Redis 에 요청이 저장되지 않음
> redis 연결이 끊어지거나 컨테이너 다운

- 탐지 가능한 방법
  - redis 헬스 체크 실패 시
  - redis 관련 예외 발생 시

- 대응 방안
  - 자동 재시도 로직 실행
  - kafka 도입 -> redis 이전 단계의 버퍼 처리

-------

### 2. 중복 요청 발생
> 실제 발급 가능한 수량보다 더 많은 요청을 처리한 경우 발생하는 장애

- 탐지 가능한 방법
  - reids coupon 수량 값이 음수가 되는 것을 모니터링
  - 로그로 발급 건수 모니터링

- 대응 방안
  - 쿠폰 수량 차감 후 확인 로직 

--------

### 3. 배치 발급 실패
> 배치 스케줄러 스레드의 중단 <br>
> 스케줄 등록 누락

- 탐지 가능한 방법
  - 발급 성공 처리 수가 줄어드는 형상 모니터링

- 대응 방안
  - 예외가 발생한 사용자만 건너뛰고, 다음 사용자로
  - 예외가 난 유저는 Redis나 DB에 실패로 저장 후 나중에 실패 사용자만 재시도
  
---------

### 4. Redis 서버 과부하
> 트래픽이 몰리면서 생기는 애플리케이션 응답 지연

- 탐지 가능한 방법
  - 애플리케이션 사용량을 시각화

- 대응 방안
  - 클러스터 구성 
  - Kafka로 fallback 저장
  

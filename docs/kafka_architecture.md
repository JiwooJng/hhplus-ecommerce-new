## 이커머스 주요 기능

| 기능           | 설명                                  | 동기/비동기  |
| ------------- | ------------------------------------- | --------- |
| 주문 생성       | 재고 확인 및 차감, 쿠폰 사용 처리, 주문 저장   | 동기        |
| 결제 처리       | 포인트 차감, 결제 성공/실패 처리             | 동기        |
| 주문 완료 시     | 알림 전송, 인기 상품 집계                  | 비동기      |
| 선착순 쿠폰 발급  | Redis 큐, Kafka로 요청 처리 → 발급        | 비동기      |



## Kafka 적용 위치 및 판단 기준

#### ❌주문 생성, 결제 처리	
- 실시간성 및 트랜잭션 일관성이 중요

#### ✅ 선착순 쿠폰 발급	
- 트래픽 급증할 수 있는 상황
- 비동기 큐 필요

🌊 플로우
1. 사용자의 쿠폰 발급 요청
2. Redis 큐에 저장
3. Kafka 쿠폰 발급 요청 성공에 대한 이벤트 발행
4. 쿠폰 발급 요청 성공에 대한 이벤트 소비
   - Redis에서 수량 확인
   - 성공 시 쿠폰 발급 및 영속화
5. 쿠폰 발급 성공에 대한 이벤트 발행
6. 쿠폰 발급 성공에 대한 이벤트 소비
   - 사용자에게 알림 전송

> 기대효과:
> - 대량 트래픽에도 서버 부하 없음
> - Kafka로 재처리 가능
> - 추후 이벤트 알림 등도 쉽게 붙일 수 있음

#### ✅ 주문 완료 후 후속 작업
- 주문 저장과 포인트 적립, 완료 알림을 분리

🌊 플로우
1. 사용자의 주문 요청
2. 주문 저장 완료 및 결제 요청
3. 결제 성공 시 주문 완료 이벤트 발행
4. 주문 완료 이벤트 소비
   - 사용자에게 알림 전송
   - 외부 통계 플랫폼으로 전송(인기상품 집계 등)
  
> 기대효과
> - 도메인 간 결합 해소 (느슨한 결합)
> - 후속 로직 실패해도 주문에 영향 없음

#### ✅ 확장 가능한 이벤트 로그 기록
- 감사, 모니터링용으로 활용 가능


### 결론
Kafka는 시스템 전체에 무조건 사용하지 않고,
대량 트래픽이 유입되거나 도메인 간 결합을 줄이는 것이 중요한 위치에만 선택적으로 사용한다.

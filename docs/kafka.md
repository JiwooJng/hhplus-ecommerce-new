## 비동기 통신을 사용하는 이유

1. 시스템 간 결합도를 낮출 수 있음
   - 동기 방식
     - A → B로 요청했을 때 만약 B가 느리거나 장애가 생기면 A도 영향을 받음.
   - 비동기 방식
     - A는 메시지를 큐에 넣고 바로 다음 작업으로 넘어가고 B는 나중에 그 메시지를 꺼내서 처리함.
     - B가 잠시 죽어도 A는 영향을 받지 않고 유지보수 및 기능 확장이 쉬움.

2. 처리 속도 향상 
   - 동기 방식
     - 요청 → 처리 → 응답 까지 대기 시간 있음.
   - 비동기 방식
     - 요청 → 메시지 큐 적재 → 응답 (거의 바로)

3. 트래픽이 급증해도 대응 가능
   - 실시간 트래픽 폭주 시에도 큐에 쌓아두고 조금씩 천천히 소비하기 때문에 안정적인 대응이 가능함.
   - 메시지 큐 : 버퍼 역할
  
4. 에러 및 재처리
   - 메시지를 못 받거나 처리 실패하더라도 재처리 시도가 가능함.
  
5. MSA 아키텍처에 적합
   - 개별적인 배포·확장·장애 조치가 가능함.
  
## 메시지 브로커
> 애플리케이션 간의 비동기 메시지 전달을 중개해주는 시스템

### 역할

1. 비동기 통신
   - 생산자(Producer)와 소비자(Consumer)가 동시에 동작하지 않아도 됨

2. 디커플링
   - 서로 다른 시스템을 느슨하게 연결 (서로 몰라도 통신 가능)
  
3. 버퍼링
   - 트래픽 폭주 시 메시지를 일시적으로 저장해서 시스템 안정화
  
4. 재처리
   - 장애나 실패 발생 시 메시지를 다시 처리할 수 있음 (offset 기반)

5. 모니터링
   - 메시지 흐름 추적, 로깅, 장애 분석 등에 유용함.
  
### 종류
- Kafka
- RabbitMQ
- ActiveMQ
- Redis Streams
- AWS SQS
  

## Kafka 
> 메시지 큐 시스템
> 
> MSA 구조나 대용량 데이터 처리 쪽에서 많이 쓰이고 있음.

### 핵심 구성 요소 

#### Topic
- 메시지가 저장되는 카테고리 또는 채널.
- 각 Topic은 여러 개의 Partition으로 나뉠 수 있어 병렬처리가 가능함.

#### Producer
- Kafka로 메시지를 보내는 클라이언트
- ex) 주문 생성 시 order created로 메시지 전송
- 어떤 Partition에 메시지를 보낼지 정할 수 있음.

#### Consumer
- Kafka에서 메시지를 읽는 클라이언트
- 일반적으로 Consumer Group 단위로 묶어서 동작함.

#### Consumer Group 
- 같은 Group에 속한 Consumer들은 서로 다른 파티션을 나눠서 처리
- 하나의 메시지는 하나의 그룹 내에선 단 한 번만 소비됨.
- 서로 다른 Group은 같은 메시지를 각각 소비할 수 있음.

#### Broker
- Kafka 서버 그 잡채
- 메시지를 저장하고 Producer/Consumer와 통신함.
- 실제로는 여러 개의 Broker가 클러스터로 구성되어 메시지를 분산 저장함.
- 각 Broker는 여러 Topic의 Partition을 저장하고 있음.

#### Partition
- Topic을 수평적으로 나눈 단위.
- 병렬 소비를 가능하게 하고, 대량 트래픽 처리에 유리함.
- 각 메시지는 Partition 내에서는 순서가 보장됨.
- cf) 전체 Topic 수준에서는 순서 보장 안됨.

#### Offset
- Partition 내 메시지의 위치를 나타내는 고유 번호.
- Consumer는 Offset을 기준으로 메시지를 어디까지 읽었는지 관리함.

#### Replication
- 고가용성을 위해 각 Partition은 여러 Broker에 복제됨.
- Leader Replica: 읽기/쓰기가 가능한 복제본
- Follower Replica: Leader의 데이터 백업


### Kafka 를 선택하는 이유

1. 대용량 처리 성능

2. 메시지가 디스크에 저장되고 복제되어 유실 위험 낮음.

3. 확장성이 뛰어남.
   - 파티션 기반 수평 확장 (브로커/컨슈머 자유롭게 추가 가능)

4. 재처리가 쉬움.

5. Kafka Streams, Kafka Connect, ksqlDB 등 강력한 툴들이 존재함. -> 오픈소스

